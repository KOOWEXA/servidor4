<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaxiM√≥vil</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            max-width: 100%;
            overflow-x: hidden;
        }
        
        .container {
            width: 100%;
            padding: 15px;
        }
        
        header {
            background-color: #1a73e8;
            color: white;
            padding: 15px;
            text-align: center;
            border-radius: 0 0 10px 10px;
            margin-bottom: 15px;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }
        
        .btn {
            background-color: #1a73e8;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            width: 100%;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
        }
        
        .btn-secondary {
            background-color: #5f6368;
            margin-top: 10px;
        }
        
        .map-container {
            height: 200px;
            border-radius: 8px;
            overflow: hidden;
            margin-top: 10px;
            border: 1px solid #ddd;
        }
        
        .driver-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .driver-card {
            display: flex;
            align-items: center;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
        }
        
        .driver-card.selected {
            border-color: #1a73e8;
            background-color: #e8f0fe;
        }
        
        .driver-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #ddd;
            margin-right: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        
        .driver-info {
            flex: 1;
        }
        
        .driver-name {
            font-weight: 500;
            margin-bottom: 5px;
        }
        
        .driver-rating {
            color: #fbbc05;
            font-size: 0.9rem;
        }
        
        .hidden {
            display: none;
        }
        
        .section-title {
            margin-bottom: 15px;
            font-size: 1.2rem;
            color: #1a73e8;
        }
        
        .tab-container {
            display: flex;
            margin-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }
        
        .tab {
            padding: 10px 15px;
            cursor: pointer;
            font-weight: 500;
        }
        
        .tab.active {
            border-bottom: 2px solid #1a73e8;
            color: #1a73e8;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">üöï TaxiM√≥vil</div>
        </header>
        
        <div class="tab-container">
            <div class="tab active" id="tab-form">Solicitar Viaje</div>
            <div class="tab" id="tab-drivers">Conductores</div>
        </div>
        
        <div id="form-section">
            <div class="card">
                <div class="section-title">Datos del Viaje</div>
                
                <div class="form-group">
                    <label for="nombre">Nombre Completo</label>
                    <input type="text" id="nombre" placeholder="Tu nombre completo" required>
                </div>
                
                <div class="form-group">
                    <label for="telefono">N√∫mero de Tel√©fono</label>
                    <input type="tel" id="telefono" placeholder="Ej: +1234567890" required>
                </div>
                
                <div class="form-group">
                    <label for="origen">Direcci√≥n de Origen</label>
                    <input type="text" id="origen" placeholder="Donde te recogemos">
                    <button class="btn btn-secondary" id="btn-map-origen">Usar Mapa para Origen</button>
                </div>
                
                <div class="form-group">
                    <label for="destino">Direcci√≥n de Destino</label>
                    <input type="text" id="destino" placeholder="A donde vas">
                    <button class="btn btn-secondary" id="btn-map-destino">Usar Mapa para Destino</button>
                </div>
                
                <div class="form-group">
                    <label for="fecha">Fecha de Recogida</label>
                    <input type="date" id="fecha" required>
                </div>
                
                <div class="form-group">
                    <label for="hora">Hora de Recogida</label>
                    <input type="time" id="hora" required>
                </div>
                
                <button class="btn" id="btn-continue">Continuar a Conductores</button>
            </div>
        </div>
        
        <div id="drivers-section" class="hidden">
            <div class="card">
                <div class="section-title">Selecciona un Conductor</div>
                
                <div class="driver-list" id="driver-list">
                    <!-- Los conductores se cargar√°n aqu√≠ din√°micamente -->
                </div>
                
                <button class="btn" id="btn-confirm">Confirmar y Enviar por WhatsApp</button>
                <button class="btn btn-secondary" id="btn-back">Volver al Formulario</button>
            </div>
        </div>
        
        <div id="map-modal" class="hidden">
            <div class="card">
                <div class="section-title" id="map-title">Selecciona ubicaci√≥n en el mapa</div>
                <div class="map-container" id="map"></div>
                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <button class="btn" id="btn-confirm-location">Confirmar Ubicaci√≥n</button>
                    <button class="btn btn-secondary" id="btn-cancel-map">Cancelar</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        let map;
        let marker;
        let currentMapField = '';
        let selectedDriver = null;
        
        const drivers = [
            { id: 1, name: "Carlos Mendoza", phone: "+1234567890", rating: 4.8, car: "Toyota Corolla 2020" },
            { id: 2, name: "Ana Rodr√≠guez", phone: "+1234567891", rating: 4.9, car: "Honda Civic 2021" },
            { id: 3, name: "Miguel Torres", phone: "+1234567892", rating: 4.7, car: "Nissan Sentra 2019" },
            { id: 4, name: "Laura S√°nchez", phone: "+1234567893", rating: 4.8, car: "Hyundai Elantra 2020" }
        ];
        
        document.getElementById('tab-form').addEventListener('click', function() {
            showSection('form-section');
            setActiveTab('tab-form');
        });
        
        document.getElementById('tab-drivers').addEventListener('click', function() {
            if (validateForm()) {
                showSection('drivers-section');
                setActiveTab('tab-drivers');
                loadDrivers();
            }
        });
        
        document.getElementById('btn-continue').addEventListener('click', function() {
            if (validateForm()) {
                showSection('drivers-section');
                setActiveTab('tab-drivers');
                loadDrivers();
            }
        });
        
        document.getElementById('btn-back').addEventListener('click', function() {
            showSection('form-section');
            setActiveTab('tab-form');
        });
        
        document.getElementById('btn-map-origen').addEventListener('click', function() {
            currentMapField = 'origen';
            showMapModal();
        });
        
        document.getElementById('btn-map-destino').addEventListener('click', function() {
            currentMapField = 'destino';
            showMapModal();
        });
        
        document.getElementById('btn-confirm-location').addEventListener('click', function() {
            if (marker) {
                const latlng = marker.getLatLng();
                const address = `Lat: ${latlng.lat.toFixed(6)}, Lng: ${latlng.lng.toFixed(6)}`;
                document.getElementById(currentMapField).value = address;
            }
            hideMapModal();
        });
        
        document.getElementById('btn-cancel-map').addEventListener('click', function() {
            hideMapModal();
        });
        
        document.getElementById('btn-confirm').addEventListener('click', function() {
            if (!selectedDriver) {
                alert('Por favor selecciona un conductor');
                return;
            }
            
            sendWhatsApp();
        });
        
        function showSection(sectionId) {
            document.getElementById('form-section').classList.add('hidden');
            document.getElementById('drivers-section').classList.add('hidden');
            document.getElementById(sectionId).classList.remove('hidden');
        }
        
        function setActiveTab(tabId) {
            document.getElementById('tab-form').classList.remove('active');
            document.getElementById('tab-drivers').classList.remove('active');
            document.getElementById(tabId).classList.add('active');
        }
        
        function validateForm() {
            const nombre = document.getElementById('nombre').value;
            const telefono = document.getElementById('telefono').value;
            const fecha = document.getElementById('fecha').value;
            const hora = document.getElementById('hora').value;
            
            if (!nombre || !telefono || !fecha || !hora) {
                alert('Por favor completa todos los campos obligatorios');
                return false;
            }
            
            return true;
        }
        
        function loadDrivers() {
            const driverList = document.getElementById('driver-list');
            driverList.innerHTML = '';
            
            drivers.forEach(driver => {
                const driverCard = document.createElement('div');
                driverCard.className = 'driver-card';
                driverCard.dataset.id = driver.id;
                
                driverCard.innerHTML = `
                    <div class="driver-avatar">üë§</div>
                    <div class="driver-info">
                        <div class="driver-name">${driver.name}</div>
                        <div class="driver-rating">‚≠ê ${driver.rating}</div>
                        <div>${driver.car}</div>
                    </div>
                `;
                
                driverCard.addEventListener('click', function() {
                    document.querySelectorAll('.driver-card').forEach(card => {
                        card.classList.remove('selected');
                    });
                    this.classList.add('selected');
                    selectedDriver = driver;
                });
                
                driverList.appendChild(driverCard);
            });
        }
        
        function showMapModal() {
            document.getElementById('map-modal').classList.remove('hidden');
            document.getElementById('map-title').textContent = `Selecciona ubicaci√≥n de ${currentMapField}`;
            
            if (!map) {
                initMap();
            }
        }
        
        function hideMapModal() {
            document.getElementById('map-modal').classList.add('hidden');
        }
        
        function initMap() {
            map = L.map('map').setView([19.4326, -99.1332], 13);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(map);
            
            map.on('click', function(e) {
                if (marker) {
                    map.removeLayer(marker);
                }
                
                marker = L.marker(e.latlng).addTo(map);
            });
        }
        
        function sendWhatsApp() {
            const nombre = document.getElementById('nombre').value;
            const telefono = document.getElementById('telefono').value;
            const origen = document.getElementById('origen').value;
            const destino = document.getElementById('destino').value;
            const fecha = document.getElementById('fecha').value;
            const hora = document.getElementById('hora').value;
            
            const fechaObj = new Date(fecha);
            const fechaFormateada = fechaObj.toLocaleDateString('es-ES', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            const mensaje = `Hola ${selectedDriver.name}, solicito un taxi con la siguiente informaci√≥n:%0A%0A` +
                           `*Nombre:* ${nombre}%0A` +
                           `*Tel√©fono:* ${telefono}%0A` +
                           `*Origen:* ${origen || 'No especificado'}%0A` +
                           `*Destino:* ${destino || 'No especificado'}%0A` +
                           `*Fecha:* ${fechaFormateada}%0A` +
                           `*Hora:* ${hora}%0A%0A` +
                           `Por favor, confirme mi solicitud. ¬°Gracias!`;
            
            const urlWhatsApp = `https://wa.me/${selectedDriver.phone}?text=${mensaje}`;
            
            window.open(urlWhatsApp, '_blank');
        }
        
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('fecha').setAttribute('min', today);
    </script>
</body>
</html>